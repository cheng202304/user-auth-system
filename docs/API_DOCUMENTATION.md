# ç”¨æˆ·è®¤è¯ç³»ç»Ÿ API æ¥å£æ–‡æ¡£

## ğŸ“‹ åŸºç¡€ä¿¡æ¯

### API åŸºç¡€è·¯å¾„
- **å¼€å‘ç¯å¢ƒ**: `http://localhost:3000/api`
- **ç”Ÿäº§ç¯å¢ƒ**: `https://your-domain.com/api`

### è®¤è¯æ–¹å¼
- **Header**: `Authorization: Bearer <access_token>`
- **Token è·å–**: é€šè¿‡ç™»å½•æ¥å£è·å–

### å“åº”æ ¼å¼
æ‰€æœ‰ API æ¥å£è¿”å›ç»Ÿä¸€çš„ JSON æ ¼å¼ï¼š

```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    // å…·ä½“ä¸šåŠ¡æ•°æ®
  }
}
```

### é”™è¯¯ç è¯´æ˜
| çŠ¶æ€ç  | è¯´æ˜ | å¤„ç†å»ºè®® |
|--------|------|----------|
| 200 | æˆåŠŸ | æ­£å¸¸å¤„ç†å“åº”æ•°æ® |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ | æ£€æŸ¥è¯·æ±‚å‚æ•°æ ¼å¼ |
| 401 | æœªæˆæƒ/Token æ— æ•ˆ | é‡æ–°ç™»å½•è·å– Token |
| 403 | æƒé™ä¸è¶³ | æ£€æŸ¥ç”¨æˆ·è§’è‰²æƒé™ |
| 404 | èµ„æºä¸å­˜åœ¨ | æ£€æŸ¥èµ„æº ID æˆ–è·¯å¾„ |
| 429 | è¯·æ±‚é¢‘ç‡é™åˆ¶ | ç­‰å¾…ä¸€æ®µæ—¶é—´åé‡è¯• |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | è”ç³»ç®¡ç†å‘˜ |

## ğŸ” è®¤è¯ç›¸å…³æ¥å£

### 1. ç”¨æˆ·æ³¨å†Œ
**POST** `/api/auth/register`

#### è¯·æ±‚å‚æ•°
æ— è¯·æ±‚ä½“ï¼Œç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆè´¦å·

#### å“åº”æ•°æ®
```json
{
  "code": 200,
  "message": "æ³¨å†ŒæˆåŠŸ",
  "data": {
    "account": "123456",
    "password": "123456",
    "role": "student"
  }
}
```

#### ä¸šåŠ¡è§„åˆ™
- ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ 6 ä½æ•°å­—è´¦å· (000000-999999)
- é»˜è®¤å¯†ç ä¸º `123456`
- æ–°ç”¨æˆ·é»˜è®¤è§’è‰²ä¸º "student"
- è¶…çº§ç®¡ç†å‘˜è´¦å· (000000) ä¸èƒ½è¢«éšæœºç”Ÿæˆ

#### é”™è¯¯æƒ…å†µ
- `400`: ç³»ç»Ÿè´¦å·å·²æ»¡ï¼Œè¯·è”ç³»ç®¡ç†å‘˜

### 2. ç”¨æˆ·ç™»å½•
**POST** `/api/auth/login`

#### è¯·æ±‚å‚æ•°
```json
{
  "account": "123456",
  "password": "123456"
}
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| account | string | æ˜¯ | 6ä½æ•°å­—è´¦å· |
| password | string | æ˜¯ | ç”¨æˆ·å¯†ç  |

#### å“åº”æ•°æ®
```json
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIs...",
    "user": {
      "id": 1,
      "account": "123456",
      "username": "å¼ ä¸‰",
      "email": "zhangsan@example.com",
      "role": "student",
      "avatar": "http://example.com/avatar.jpg",
      "created_at": "2025-02-10T00:00:00Z"
    }
  }
}
```

#### ä¸šåŠ¡è§„åˆ™
- è´¦å·å¿…é¡»æ˜¯ 6 ä½æ•°å­—
- å¯†ç é•¿åº¦è‡³å°‘ 6 ä½
- ç™»å½•å¤±è´¥ 5 æ¬¡åé”å®šè´¦å· 30 åˆ†é’Ÿ

#### é”™è¯¯æƒ…å†µ
- `400`: è´¦å·æˆ–å¯†ç é”™è¯¯
- `403`: è´¦å·å·²é”å®šï¼Œè¯· 30 åˆ†é’Ÿåå†è¯•

### 3. ç”¨æˆ·ç™»å‡º
**POST** `/api/auth/logout`

#### è¯·æ±‚å¤´
- `Authorization: Bearer <access_token>`

#### å“åº”æ•°æ®
```json
{
  "code": 200,
  "message": "ç™»å‡ºæˆåŠŸ"
}
```

### 4. è·å–ç™»å½•çŠ¶æ€
**GET** `/api/auth/status`

#### å“åº”æ•°æ®
```json
// å·²ç™»å½•çŠ¶æ€
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "isAuthenticated": true,
    "user": {
      "id": 1,
      "account": "123456",
      "username": "å¼ ä¸‰",
      "role": "student",
      "avatar": "http://example.com/avatar.jpg"
    }
  }
}

// æœªç™»å½•çŠ¶æ€
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "isAuthenticated": false,
    "user": null
  }
}
```

## ğŸ‘¤ ä¸ªäººä¸­å¿ƒæ¥å£

### 1. è·å–ä¸ªäººä¿¡æ¯
**GET** `/api/user/profile`

#### è¯·æ±‚å¤´
- `Authorization: Bearer <access_token>`

#### å“åº”æ•°æ®
```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "id": 1,
    "account": "123456",
    "username": "å¼ ä¸‰",
    "email": "zhangsan@example.com",
    "phone": "13800138000",
    "role": "student",
    "avatar": "http://example.com/avatar.jpg",
    "status": 1,
    "created_at": "2025-02-10T00:00:00Z"
  }
}
```

### 2. æ›´æ–°ä¸ªäººä¿¡æ¯
**PUT** `/api/user/profile`

#### è¯·æ±‚å¤´
- `Authorization: Bearer <access_token>`

#### è¯·æ±‚å‚æ•°
```json
{
  "username": "æ–°ç”¨æˆ·å",
  "email": "new@example.com",
  "phone": "13900139000",
  "avatar": "http://example.com/new-avatar.jpg"
}
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| username | string | å¦ | ç”¨æˆ·å (2-20å­—ç¬¦) |
| email | string | å¦ | é‚®ç®±åœ°å€ |
| phone | string | å¦ | 11ä½æ‰‹æœºå· |
| avatar | string | å¦ | å¤´åƒURL |

#### å“åº”æ•°æ®
```json
{
  "code": 200,
  "message": "æ›´æ–°æˆåŠŸ"
}
```

#### ä¸šåŠ¡è§„åˆ™
- ç”¨æˆ·åä¸èƒ½ä¸ºç©ºï¼Œé•¿åº¦ 2-20 ä¸ªå­—ç¬¦
- é‚®ç®±æ ¼å¼å¿…é¡»æ­£ç¡®
- æ‰‹æœºå·å¿…é¡»ä¸º 11 ä½æ•°å­—
- å¤´åƒå¤§å°é™åˆ¶åœ¨ 2MB ä»¥å†…ï¼Œæ”¯æŒ jpgã€png æ ¼å¼

### 3. ä¿®æ”¹å¯†ç 
**POST** `/api/user/change-password`

#### è¯·æ±‚å¤´
- `Authorization: Bearer <access_token>`

#### è¯·æ±‚å‚æ•°
```json
{
  "oldPassword": "123456",
  "newPassword": "newpassword123"
}
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| oldPassword | string | æ˜¯ | å½“å‰å¯†ç  |
| newPassword | string | æ˜¯ | æ–°å¯†ç  (è‡³å°‘6ä½) |

#### å“åº”æ•°æ®
```json
{
  "code": 200,
  "message": "å¯†ç ä¿®æ”¹æˆåŠŸï¼Œè¯·é‡æ–°ç™»å½•"
}
```

#### ä¸šåŠ¡è§„åˆ™
- æ–°å¯†ç é•¿åº¦è‡³å°‘ 6 ä½
- æ–°å¯†ç ä¸èƒ½ä¸æ—§å¯†ç ç›¸åŒ
- ä¿®æ”¹æˆåŠŸåéœ€è¦é‡æ–°ç™»å½•

## ğŸ‘¨â€ğŸ’¼ ç”¨æˆ·ç®¡ç†æ¥å£ (ä»…ç®¡ç†å‘˜)

### 1. è·å–ç”¨æˆ·åˆ—è¡¨
**GET** `/api/admin/users`

#### è¯·æ±‚å¤´
- `Authorization: Bearer <access_token>`

#### æŸ¥è¯¢å‚æ•°
| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| page | number | é¡µç  (é»˜è®¤: 1) |
| pageSize | number | æ¯é¡µæ•°é‡ (é»˜è®¤: 20) |
| role | string | è§’è‰²ç­›é€‰ |
| status | number | çŠ¶æ€ç­›é€‰ (1-æ­£å¸¸, 0-ç¦ç”¨) |
| keyword | string | å…³é”®è¯æœç´¢ (è´¦å·/ç”¨æˆ·å/é‚®ç®±) |

#### ç¤ºä¾‹è¯·æ±‚
```
GET /api/admin/users?page=1&pageSize=20&role=student&status=1&keyword=å¼ ä¸‰
```

#### å“åº”æ•°æ®
```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "list": [
      {
        "id": 2,
        "account": "123456",
        "username": "å¼ ä¸‰",
        "email": "zhangsan@example.com",
        "phone": "13800138001",
        "role": "student",
        "status": 1,
        "created_at": "2025-02-10T00:00:00Z"
      }
    ],
    "total": 100,
    "page": 1,
    "pageSize": 20,
    "totalPages": 5
  }
}
```

### 2. åˆ›å»ºç”¨æˆ·
**POST** `/api/admin/users`

#### è¯·æ±‚å¤´
- `Authorization: Bearer <access_token>`

#### è¯·æ±‚å‚æ•°
```json
{
  "username": "æå››",
  "email": "lisi@example.com",
  "phone": "13800138002",
  "role": "student"
}
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| username | string | æ˜¯ | ç”¨æˆ·å |
| email | string | æ˜¯ | é‚®ç®±åœ°å€ |
| phone | string | å¦ | æ‰‹æœºå· |
| role | string | æ˜¯ | è§’è‰² (admin/teacher/student) |

#### å“åº”æ•°æ®
```json
{
  "code": 200,
  "message": "åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": 3,
    "account": "123457",
    "password": "123456"
  }
}
```

#### ä¸šåŠ¡è§„åˆ™
- ç³»ç»Ÿè‡ªåŠ¨åˆ†é…å¯ç”¨è´¦å·
- é»˜è®¤å¯†ç ä¸º `123456`
- ä¸èƒ½åˆ›å»ºè¶…çº§ç®¡ç†å‘˜è´¦å· (000000)

### 3. æ›´æ–°ç”¨æˆ·
**PUT** `/api/admin/users/{id}`

#### è¯·æ±‚å¤´
- `Authorization: Bearer <access_token>`

#### è·¯å¾„å‚æ•°
| å‚æ•° | è¯´æ˜ |
|------|------|
| id | ç”¨æˆ·ID |

#### è¯·æ±‚å‚æ•°
```json
{
  "username": "æ–°å§“å",
  "email": "newemail@example.com",
  "role": "teacher",
  "status": 1
}
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| username | string | å¦ | ç”¨æˆ·å |
| email | string | å¦ | é‚®ç®±åœ°å€ |
| role | string | å¦ | è§’è‰² |
| status | number | å¦ | çŠ¶æ€ (1-æ­£å¸¸, 0-ç¦ç”¨) |

#### å“åº”æ•°æ®
```json
{
  "code": 200,
  "message": "æ›´æ–°æˆåŠŸ"
}
```

### 4. é‡ç½®ç”¨æˆ·å¯†ç 
**POST** `/api/admin/users/{id}/reset-password`

#### è¯·æ±‚å¤´
- `Authorization: Bearer <access_token>`

#### è·¯å¾„å‚æ•°
| å‚æ•° | è¯´æ˜ |
|------|------|
| id | ç”¨æˆ·ID |

#### å“åº”æ•°æ®
```json
{
  "code": 200,
  "message": "å¯†ç å·²é‡ç½®ä¸º 123456"
}
```

### 5. åˆ é™¤ç”¨æˆ·
**DELETE** `/api/admin/users/{id}`

#### è¯·æ±‚å¤´
- `Authorization: Bearer <access_token>`

#### è·¯å¾„å‚æ•°
| å‚æ•° | è¯´æ˜ |
|------|------|
| id | ç”¨æˆ·ID |

#### å“åº”æ•°æ®
```json
{
  "code": 200,
  "message": "åˆ é™¤æˆåŠŸ"
}
```

#### ä¸šåŠ¡è§„åˆ™
- åˆ é™¤å‰éœ€è¦äºŒæ¬¡ç¡®è®¤
- è¶…çº§ç®¡ç†å‘˜è´¦å· (000000) ä¸èƒ½è¢«åˆ é™¤
- ç®¡ç†å‘˜ä¸èƒ½åˆ é™¤å…¶ä»–ç®¡ç†å‘˜ (åªæœ‰è¶…çº§ç®¡ç†å‘˜å¯ä»¥)

## ğŸ›¡ï¸ å®‰å…¨è¯´æ˜

### è¯·æ±‚é¢‘ç‡é™åˆ¶
- ç™»å½•æ¥å£: 5æ¬¡/åˆ†é’Ÿ
- å…¶ä»–æ¥å£: 100æ¬¡/åˆ†é’Ÿ

### è¾“å…¥éªŒè¯
æ‰€æœ‰ç”¨æˆ·è¾“å…¥éƒ½ç»è¿‡ä¸¥æ ¼çš„éªŒè¯å’Œæ¸…ç†ï¼Œé˜²æ­¢ï¼š
- SQL æ³¨å…¥æ”»å‡»
- XSS æ”»å‡»  
- è·¯å¾„éå†æ”»å‡»

### æ•æ„Ÿä¿¡æ¯å¤„ç†
- å¯†ç ä½¿ç”¨ BCrypt åŠ å¯†å­˜å‚¨
- Token ä¸åŒ…å«æ•æ„Ÿä¿¡æ¯
- æ—¥å¿—ä¸­ä¸è®°å½•å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯

## ğŸ§ª æµ‹è¯•ç¤ºä¾‹

### ä½¿ç”¨ curl æµ‹è¯•ç™»å½•
```bash
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"account":"123456","password":"123456"}'
```

### ä½¿ç”¨ Postman æµ‹è¯•
1. å¯¼å…¥é¡¹ç›®æ ¹ç›®å½•çš„ `user-auth-system.postman_collection.json`
2. è®¾ç½®ç¯å¢ƒå˜é‡ `BASE_URL`
3. æ‰§è¡Œå„ä¸ªæ¥å£æµ‹è¯•

---
**API ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2026-02-16